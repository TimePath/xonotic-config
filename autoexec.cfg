// TimePath

exec reset.cfg

physics xonotic

minplayers 4

menu_watermark ""
alias menu_watermark ""

// Player

cl_allow_uid2name "1"
_cl_name "TimePath"
_cl_color "222"
_cl_playermodel "models/player/megaerebus.iqm"

// Halogene

hud_damage_blur 0
hud_damage 0.4

cl_forceplayermodels "1"
cl_forceplayercolors "0" // incompatible with some minsta

cl_gentle_gibs 1

cl_particles_alpha 0.2
cl_particles_sparks 0
cl_particles_blood 0
r_coronas 0
r_bloom 0

gl_picmip_world 10
gl_texturecompression 1

cl_simple_items 1

// Crosshair...

//r_drawviewmodel 0
cl_reticle 0
cl_zoomspeed -1
cl_unpress_zoom_on_weapon_switch 1

cl_bobfall 0
cl_bobmodel 0
cl_bobup 0

cl_deathscoreboard 1


// Binds

alias moved ""

bind w "+w; moved"
bind s "+s; moved"
bind a "+a; moved"
bind d "+d; moved"

alias +w "alias =w +forward; =w; -back"
alias -w "alias =w -forward; =w; =s"
alias +s "alias =s +back; =s; -forward"
alias -s "alias =s -back; =s; =w"

alias +a "alias =a +moveleft; =a; -moveright"
alias -a "alias =a -moveleft; =a; =d"
alias +d "alias =d +moveright; =d; -moveleft"
alias -d "alias =d -moveright; =d; =a"


bind SPACE "+jump"
bind ALT "reload"
bind SHIFT "+crouch"

bind ENTER "messagemode"
bind BACKSLASH "messagemode2"
bind BACKSPACE "+con_chat_maximize"

bind TAB "+userbind 19"
bind ESCAPE "togglemenu"
bind BACKQUOTE "toggleconsole"

bind 0 "// not bound"
bind 1 "// not bound"
bind 5 "// not bound"
bind 6 "// not bound"
bind 7 "// not bound"
bind 8 "// not bound"
bind 9 "// not bound"

bind f "+use"
bind g "dropweapon"
bind i "+show_info"
bind k "kill"
bind m "+hud_panel_radar_maximized"
bind p "// not bound"
bind t "// not bound"
bind u "// not bound"
bind v "+button8"
bind y "// not bound"
bind z "// not bound"
bind TILDE "// not bound"

bind UPARROW "// not bound"
bind DOWNARROW "// not bound"
bind LEFTARROW "// not bound"
bind RIGHTARROW "// not bound"

bind F1 "vyes"
bind F2 "vno"
bind F3 "spec"
bind F4 "ready"
bind F5 "menu_showteamselect"
bind F6 "team_auto"
bind F7 "menu_showsandboxtools"
bind F10 "disconnect"
bind F11 "+userbind 21"
bind F12 "screenshot"

bind PAUSE "pause"

bind KP_INS "team_auto"
bind KP_END "+userbind 1"
bind KP_DOWNARROW "+userbind 2"
bind KP_PGDN "+userbind 3"
bind KP_LEFTARROW "+userbind 4"
bind KP_5 "+userbind 6"
bind KP_RIGHTARROW "+userbind 7"
bind KP_HOME "+userbind 9"
bind KP_UPARROW "+userbind 10"
bind KP_PGUP "+userbind 11"
bind KP_DEL "// not bound"
bind KP_SLASH "+userbind 13"
bind KP_MULTIPLY "+userbind 12"
bind KP_MINUS "+userbind 18"
bind KP_PLUS "+userbind 17"
bind KP_ENTER "+userbind 16"

// http://forums.xonotic.org/showthread.php?tid=2987


// Conditionals
// Principles:
// Commands are chained because aliases are expanded *before* entering them
// Toggle makes all nonzero values become zero

alias if "_if[*] ${1}; toggle _if[*]; alias _if[0] ${2-}; _if.2"
alias _if.2 "_if[${_if[*]}]"
set _if[*] "" // variable value to check
alias _if[1] // noop to reduce console spam




// Arithmetic
// load is used to avoid name clashes with rpn commands

alias ++ "rpn /${1} dup load 1 + ="
alias -- "rpn /${1} dup load 1 - ="




// Hash-based String Comparison
// Principle: if the hashes collide, the same variable will be overwritten

alias strcmp "rpn /_arg[1] \"/${1}\" /SHA256 digest =; rpn /_arg[2] \"/${2}\" /SHA256 digest =; _strcmp.2"
alias _strcmp.2 "set _strcmp[${_arg[1]}] 0; set _strcmp[${_arg[2]}] 1; set _strcmp_true \"_strcmp[${_arg[1]}]\"; _strcmp.3"
alias _strcmp.3 "set _strcmp_true ${$_strcmp_true}; set _strcmp[${_arg[1]}] 0; set _strcmp_false \"_strcmp[${_arg[2]}]\";  _strcmp.4"
alias _strcmp.4 "set _strcmp_false ${$_strcmp_false}"

alias if_strcmp "strcmp ${1} ${2}; alias _arg[3] ${3- q}; if_strcmp.2"
alias if_strcmp.2 "if ${_strcmp_true} _arg[3]"

alias if_not_strcmp "strcmp ${1} ${2}; alias _arg[3] ${3- q}; if_not_strcmp.2"
alias if_not_strcmp.2 "if ${_strcmp_false} _arg[3]"




// Weapon checks

alias if_weapon "if_strcmp ${_weapon} ${1} ${2-}"
alias if_not_weapon "if_not_strcmp ${_weapon} ${1} ${2-}"
set _weapon "none"
alias cl_hook_activeweapon "_weapon ${1}; x_on_weapon_change"




// Weaplast without laser

set weaponring ""
alias weaponring.push "rpn /_weaponring[*] /${1} weaponring union /shotgun union \"/laser none\" difference =; _weaponring.push.2"
alias _weaponring.push.2 "_weaponring.push.3 ${_weaponring[*]}"
alias _weaponring.push.3 "weaponring \"${1 ?} ${2 ?}\"""

alias x_weaplast "_x_weaplast ${weaponring} shotgun shotgun"
alias _x_weaplast "weapon_${1}"




// Weapon hooks

alias _equipped.update "equipped_${_weapon}"
alias x_on_weapon_change "_equipped.pre; _equipped.update; _equipped.post"




// Attack tracking

set x_attack.state 0
alias +x_attack "x_attack.state 1; +x_attack.impl" // FIXME: breaks minstanex when used with other weapons. +attack; +laser; -attack or +laser; +attack; -laser
// Partial fix with `_equipped.update; -x_laser; alias -x_laser.impl; `
alias -x_attack "x_attack.state 0; -x_attack.impl"

alias +x_attack.def "+fire"
alias -x_attack.def "-fire"
alias !x_attack.def "alias +x_attack.impl +x_attack.def; alias -x_attack.impl -x_attack.def"


set x_attack2.state 0
alias +x_attack2 "x_attack2.state 1; +x_attack2.impl"
alias -x_attack2 "x_attack2.state 0; -x_attack2.impl"

alias +x_attack2.def "+fire2"
alias -x_attack2.def "-fire2"
alias !x_attack2.def "alias +x_attack2.impl +x_attack2.def; alias -x_attack2.impl -x_attack2.def"


set x_laser.state 0
alias +x_laser "x_laser.state 1; +x_laser.impl"
alias -x_laser "x_laser.state 0; -x_laser.impl"

cl_weaponpriority5 "minstanex laser"
alias +x_laser.def "impulse 205"
alias -x_laser.def "-fire"
alias !x_laser.def "alias +x_laser.impl +x_laser.def; alias -x_laser.impl -x_laser.def"




// Custom stuff

set weaponring.accept 0
alias _equipped.pre  "weaponring.accept 1; !x_attack.def; !x_attack2.def; !x_laser.def"
alias _equipped.post "if ${weaponring.accept} weaponring.push ${_weapon}; if ${x_attack.state} +x_attack; if ${x_attack2.state} +x_attack2; if ${x_laser.state} +x_laser"




// Defaults

alias equipped_none ""

alias equipped_crylink ""
alias equipped_electro ""
alias equipped_fireball ""
alias equipped_grenadelauncher ""
alias equipped_hagar ""
alias equipped_hlac ""
alias equipped_hook ""
alias equipped_laser ""
alias equipped_minelayer ""
alias equipped_minstanex ""
alias equipped_nex ""
alias equipped_porto ""
alias equipped_rifle ""
alias equipped_rocketlauncher ""
alias equipped_seeker ""
alias equipped_shotgun ""
alias equipped_tuba ""
alias equipped_uzi ""

// For custom weapons

alias weapon_blaster "weapon_laser"
alias equipped_blaster "equipped_laser"

alias weapon_vaporizer "weapon_minstanex"
alias equipped_vaporizer "equipped_minstanex"

alias weapon_machinegun "weapon_uzi"
alias equipped_machinegun "equipped_uzi"

alias weapon_mortar "weapon_grenadelauncher"
alias equipped_mortar "equipped_grenadelauncher"

alias weapon_devastator "weapon_rocketlauncher"
alias equipped_devastator "equipped_rocketlauncher"

alias weapon_vortex "weapon_nex"
alias equipped_vortex "equipped_nex"



// Overrides

alias equipped_laser     "weaponring.accept 0; alias +x_attack.impl x_weaplast; alias +x_laser.impl +fire"
alias equipped_hook      "weaponring.accept 0; alias +x_attack.impl x_weaplast"

alias !x_attack2.zoom "alias +x_attack2.impl +zoom; alias -x_attack2.impl -zoom"
alias !x_laser.fire2 "alias +x_laser.impl +fire2; alias -x_laser.impl -fire2"
alias equipped_minstanex "!x_attack2.zoom; !x_laser.fire2"

alias equipped_rifle "!x_attack2.zoom"



bind capslock "spawnmob random"

bind MOUSE1 "+x_laser"
bind MOUSE2 "+x_attack"
bind MOUSE3 "weapon_group_2"
bind MWHEELUP "weapon_group_5"
bind MWHEELDOWN "weapon_group_4"
bind e "weapon_group_6"
bind r "weapon_group_9"
bind q "weapon_group_7"
bind c "weapon_group_8"
bind v "weapon_group_3"
bind b "weapon_porto"

bind MOUSE6 "+x_attack2" // MOUSE4
bind MOUSE7 "+hook" // MOUSE5

// Gameplay

	sensitivity "4"
	m_accelerate "0"
	
	vid_vsync "0"

	cl_reticle "0"
	cl_velocityzoom "0"
	cl_zoomfactor "5"

	fov "110"
	
	cl_autoswitch "0"

	cl_gunalign "1" // Center gun

	crosshair "20" // 27, 16, 20
	crosshair_alpha "0.75"
	crosshair_dot "1"
	crosshair_dot_color "1 1 1"

	crosshair_pickup "0" // No visual pickup indication

	crosshair_hitindication "0.1"

	// Disable hit testing
	crosshair_hittest "1" // 1.25
	crosshair_hittest_blur "0"
	crosshair_hittest_showimpact "0"

	crosshair_ring_inner "1"
	crosshair_ring_reload_size "2"

	crosshair_size "0.3"
	crosshair_dot_size "1.25"

	crosshair_minstanex_size "0.8"

	cl_bob "0"
	cl_bob2 "0
	cl_bobmodel "0"
	cl_bobup "0"
	cl_bobfall "0"
	cl_smoothviewheight "0"
	cl_leanmodel "0"
	cl_followmodel "0"

	// Accuracy

	scoreboard_accuracy "1"
	accuracy_color1 "0 1 0"
	accuracy_color2 "0 0 1"
	accuracy_color_levels "0 50 100"

// Video
	
	v_gamma 1.125
	cl_spawn_point_particles 1

	// exec "effects-omg.cfg" // omg, low, med, normal, high, ultra, ultimate
	
	// omg
	
	cl_decals 0
	cl_decals_models 0
	cl_decals_time 2
	cl_particles_quality 0.4
	cl_damageeffect 0
	cl_playerdetailreduction 4
	gl_flashblend 1
	gl_picmip 1337
	mod_q3bsp_nolightmaps 1
	r_bloom 0
	r_coronas 1
	r_coronas_occlusionquery 0
	hud_postprocessing_maxbluralpha 0
	hud_powerup 0
	r_depthfirst 0
	r_drawdecals_drawdistance 100
	r_drawparticles_drawdistance 250
	r_glsl_deluxemapping 0
	r_glsl_offsetmapping 0
	r_glsl_offsetmapping_reliefmapping 0
	r_motionblur 0
	r_shadow_gloss 0
	r_shadow_realtime_dlight 0
	r_shadow_realtime_dlight_shadows 0
	r_shadow_realtime_world 0
	r_shadow_realtime_world_shadows 0
	r_shadow_shadowmapping 0
	r_shadow_usenormalmap 0
	r_showsurfaces 3
	r_subdivisions_tolerance 16
	r_texture_dds_load 1
	
	// low
	
// 	cl_decals 1
// 	cl_playerdetailreduction 2
// 	gl_picmip 1
// 	r_drawdecals_drawdistance 200
// 	r_drawparticles_drawdistance 500
	r_showsurfaces 0 // 3 = single color
// 	r_subdivisions_tolerance 8
	
	// cel shading outline
	
// 	r_shadow_deferred "1"
// 	r_celoutlines "1"
// 	r_celshading "0"
	
	// Shadows - nice
	
// 	r_shadows "1"
// 	r_shadow_shadowmapping "0"
	
	// Shadows - off
	
// 	r_shadows "0"
// 	r_shadow_shadowmapping "0"
	
	// Simplicity
	
	cl_casings "0"
	cl_simple_items "1"
	r_ambient "32"
// 	r_drawparticles "0"

// 	gl_picmip "3"
// 	gl_picmip_world "10"
	//gl_picmip_other "1" // players
	
	// Water - low
	
	r_water 0
	r_water_resolutionmultiplier 0.25
	
	// Water - good portals

	r_water "1"
	r_water_resolutionmultiplier "1"
	
// 	r_water_hideplayer "2"
// 	r_water_reflectdistort "0"
// 	r_water_refractdistort "0"
// 	r_waterwarp "0"
//	r_water_lowquality "2"

// Audio

	mastervolume "1"
	snd_channel6volume "1" // TODO: disable in minsta

	snd_mutewhenidle "0"
	snd_spatialization_control "1"
	menu_snd_attenuation_method "0"

// HUD

	// Frag messages

	hud_panel_centerprint "1"
	hud_panel_centerprint_fontscale "1"
	hud_panel_timer_increment "0"

// Perf

	cl_maxfps_alwayssleep "0"
	cl_maxidlefps "20"
	cl_minfps "1000"
	cl_maxfps "0"

	gl_vbo "1" // can be buggy

	gl_texturecompression "1"

	mod_q3bsp_nolightmaps "1"

// UNCATEGORISED

	cl_curl_maxdownloads "5"
	cl_curl_maxspeed "1000"

	menu_tooltips "2"
	showfps "1"
	showtime "0"
	showdate "0"

	cl_clippedspectating "0"

	cl_joinbeforedownloadsfinish "0"

	cl_autodemo "1"
	cl_autoscreenshot "1"

	con_chat "10"

	cl_deathglow "0.8"

	seta "hud_damage" "0.5"
	seta "hud_damage_factor" "0.025"
	seta "hud_damage_fade_rate" "0.75"
	seta "hud_panel_physics" "2"
	seta "hud_panel_physics_speed_unit" "1"
	seta "hud_panel_radar_zoommode" "3"

// menu_sync

// Resolution

vid_width "1920"
vid_conwidth "960"
vid_height "1040"
vid_conheight "540"

vid_fullscreen "0"
vid_resizable "1"
